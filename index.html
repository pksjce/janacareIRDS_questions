<html>
	<head>	
		<link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css">	
		<style type="text/css">
			body{
				min-width:700px;
				background-color: #B5C59B;
				overflow:hidden;
			}
			.backgroundImg { 
			    background: url("") no-repeat center center fixed; 
			    -webkit-background-size: cover;
			    -moz-background-size: cover;
			    -o-background-size: cover;
			    background-size: cover;
			    height:100%;
			    min-width:1000px;
			}
			.fullPage,	.questionPage{
				width:100%;
				height:100%	;
			}
			.answer{
				font: 12pt arial;
				line-height: 30px;
				text-align: center;
			}
			.question{
				background-color:white;
				text-align: center;	
				height: 60px;
				font: bold 12pt arial;
				line-height: 60px;			
			}
			.answerPage{
				background-color: white;
				opacity:0.7;
				top:60px;
				right:0;				
				position:fixed;
			}
			.scoreDetailPage{
				background-color: white;
				opacity:0.7;
				top:46px;
				right:0;
				width:31.9%;
				position:fixed;	
				height:100%;			
			}			
			.anchorDec{
				text-decoration: none;
				color:black;
			}			
			.logoMiddle{
				margin-top:20px;
				margin-left:-45px;
			}
			.form{
				border:1px solid black;
			}
			.facebook {
				background: url('imgc/fb.png') no-repeat;
			}
			.header {
				width:100%;
				height:46px;
				top:0;
				left:0;
				background-color: black;
				opacity: 0.3
			}
			.absHeader{				
				top:0;
				left:0;
			}
			.footer {
				width:100%;
				height:46px;
				bottom:0;
				left:0;
				background-color: black;
				opacity: 0.3;
				position:fixed;				
			}
			.fixedBottom{
				bottom:0;
				left:0;
				position: absolute;
				width:100%;
				
			}
			.box {
				height:5px;
				width:5px;
				border:1px solid black;
			}
			.backButton, .nextButton, .startButton{
				font:bold 12pt arial;
				color:black;	
				line-height:30px;
				text-align: center;			
			}
			.backButton:hover, .nextButton:hover{
				text-decoration: none;
				color:black;
			}
			.backButtonHolder, .nextButtonHolder{
				text-align: center;
			}
			.backButtonHolder:hover, .nextButtonHolder:hover{
				background-color: white; 
				cursor:pointer;
			}
			.checked{
				background-color: white	;
				width:100%;
				opacity:0.9;
			}
			.hovered{
				background-color: white;
				opacity:0.6;
			}
			[name = 'answerOptions'] {
				cursor :pointer;
			}
			.infoButton{
				cursor: pointer;
				text-align: center;	
				height:28px;
				width:28px;						
			}
			.circleBorder{
				border:2px dotted white;
				border-radius: 60px;
			}		
			.filler {
					height: 20px
			}	
			.score{
				font:bold 65pt arial;
				color:white;
				text-align: left;
			}
			.whiteline{
				border: 2px solid white;
			}
			.scoreStatus{
				font: bold 16pt arial;
				color:white;
				text-align: left;				
			}
			.scoreAction{
				font: bold 18pt arial;
				color:white;
				text-align: left;				
			}
			.socialTab{
				position:fixed;
				bottom:130;
				left:0;
				width:32px;
				display: none;
			}
			.socialButton{
				width:30px;
				height:30px;
				margin:10px;
			}
			.helpText{
				font: 12pt arial;
				text-align: center;
				opacity: 0.99;
				padding: 20px 30px 0 30px;				
			}
			.mobileText{
				font: 100;pt arial;
				text-align: center;
				opacity: 0.99;
				padding: 70px 30px 0 30px
			}
			.downloadText{
				font: 10pt arial;
				text-align: justify;
				opacity: 0.99;				
			}
			.phBox{				
				opacity:0.99;
				
				margin-top:30px;
			}
			.navigate {
				font: bold 80pt arial;
				color: white;
				top: 0;
				left: 0;
				margin-top: 30px;
				margin-left:15px;
				z-index: 99;
				opacity: 0.99;
				position: absolute;
			}
			.takeActionText {
				text-align: center;
				font: 18pt arial;
				line-height: 1.5;
				padding-top:20px;
			}
			.foodHabits {
				height:500px;
				margin:0 150px;	
			}	
			#submitButton{
				background-color: #B5c59b;				
				margin-bottom: 13px;
			}		
			.questionsString {
				font: bold 12pt arial;
				letter-spacing: 3px;
				color: white;
				text-align: left;
				line-height: 60px;
				padding-left: 45px;
				letter-spacing:1px;
			}
			.headerText{
				font:bold 36pt arial;
				color:white;
				text-align: left;
				padding-left:40px;
			}
			.headerInfo{
				font: 12pt arial;
				color:white;
				text-align: left;
				padding-left:40px;
			}
			.enterImage{
				cursor: pointer;
				position: absolute;
				top: 20px;
				right: 20px;				
			}
			.topLeft, .scoreInfo{
				width: 16%;
				top: 0;
				left: 0;
				position: relative;
				min-width: 200px;
				min-height: 200px;
				color: white;
				height: 20%;
			}
			.scoreInfo{
				width: 50%;
				top: 0;
				left: 0;
				position: relative;
				min-width: 200px;
				min-height: 200px;
				color: white;					
				padding-left: 40px;
				text-align: left;
			}
			.topRight, .helpInfo{
				width: 30%;
				min-width: 400px;
				top: 0;
				right: 0;
				position: absolute;
				height:auto;				
			}
			.answerBox, .infoBox{				
				position: relative;
			}
			.answerOpaque, .infoOpaque{
				position:absolute;
				background-color: white;
				opacity: 0.7;
				z-index:2;
				height:100%;
				width:100%;
			}
			.infoOpaque{
				position:absolute;
				background-color: white;
				opacity: 0.7;
				z-index:2;
				height:100%;
				width:100%;	
			}
			#container{
				position:absolute;
				z-index: 5;
				width:100%;				
				overflow:auto;				
			}
			#infoContainer{				
				position:absolute;
				z-index: 5;
				width:100%;				
				overflow:auto;					
			}
			.helpInfo{
				top:0;
				right:0;
				position:absolute;
				width:30%;
				min-width:400px;
				height:auto;
				opacity:0.99;
			}
			.numberSent{
				height:30px;
				color:#67BD45;
				text-align: center;
			}
			.downloadBox{
				padding-top:30px;
			}
			.logo{
				position:fixed;
				left:0;
				bottom:0;
				width:150px;
			}
			.learnMore{
				font:11pt arial;
				color:white;
				text-align: left;
				padding-left:40px;
				cursor:pointer;
			}
			.moreInfo{
				background-color: white;
				opacity:0.8;
				margin-left:60px;
				width:200px;
				font:11pt arial;
				border:2px solid white;
			}
			</style>	
			<script type="text/javascript">

				var _gaq = _gaq || [];
				_gaq.push(['_setAccount', 'UA-38592296-1']);
				_gaq.push(['_setDomainName', 'sugarscore.in']);
				_gaq.push(['_trackPageview']);

				(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
				})();

			</script>
	</head>
<body>

<div class="backgroundImg" id="backgroundDiv">
	<div id="habits">
	</div>
	<!--div class="footer">		
	</div-->
</div>
<script src="jquery.js" type="text/javascript"></script>
<script src="bootstrap/js/bootstrap.js" type="text/javascript"></script>
<script src="underscore.js" type="text/javascript"></script>
<script src="backbone.js" type="text/javascript"></script>
<script src="http://www.parsecdn.com/js/parse-1.2.1.min.js"></script>
<script type="text/template" id="home_page_template">
	<div class="homePageEnter">
		<div class= "headerText">
				Find out your </br>
				<span style="font-size:70pt;line-height:50px">sugarscore.</span>
		</div>	
		<div class="filler">
		</div>
		<div class="filler">
		</div>			
		<div class="headerInfo">
			Developed in association with Dr. V. Mohan</br>
			at Dr. Mohan&#39;s Diabetes Speciality Center, Chennai
		</div>
		<div class="learnMore">
			Learn More..			
		</div>		
		<div class="moreInfo">
			We ll show a lot of info and stuff here
		</div>
	</div>
	<img src="imgc/enter_off.png" class="enterImage">	
</script>
<script type="text/template" id="fullPageTemplate">
	<div class="topLeft">
		<div class="questionsString">
			Question
		</div>
		<div class="navigate">
			<%=fullPageObj.questionObj.count%>/<%=fullPageObj.total%>
		</div>
	</div>
	<div class="topRight">
		<div class="question" count = "<%=fullPageObj.questionObj.count%>">
			<span><%=fullPageObj.questionObj.question%></span>
		</div>
		<div class="answerBox">
			<div class="answerOpaque">
			</div>
			<div id="container">
				<div class="answer">
					<%=fullPageObj.answerHtml%>
				</div>
				<div class="filler"></div>
				<div class="row-fluid">
					<div class="span2" >
						<div class="backButtonHolder" >
							<a href="<%=fullPageObj.backRoute%>" class="backButton">back</a>
						</div>
					</div>
					<div class="span8" id="errorDiv" style="color:red;text-align:center;font:12pt arial;line-height:28px">
						Please select an answer first.
					</div>
					<div class="span2" style="float:right">
						<div class="nextButtonHolder">
							<a href="<%=fullPageObj.nextRoute%>" class="nextButton">next</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script type="text/template" id="question_page_template">	
	<div class="answerPage">
	</div>
	<div class ="row" style="opacity:0.99; text-align:center">
		<div class ="span4 offset8">	
			<div class="row-fluid">
				<div class="answer span10 offset1">
					<%=answer%>
				</div>
			</div>					
			<div class="row-fluid">
				<div class="span2" >
					<div class="backButtonHolder" >
						<a href="<%=backRoute%>" class="backButton">back</a>
					</div>
				</div>
				<div class="span8" id="errorDiv" style="color:red;text-align:center">
					Please select an answer first.
				</div>
				<div class="span2" style="float:right">
					<div class="nextButtonHolder">
						<a href="<%=nextRoute%>" class="nextButton">next</a>
					</div>
				</div>
			</div>
		</div>				
	</div>
</script>
<script type="text/template" id="fact_page_template">
	<div class ="fullPage" style = "background-image:<%=img%>">
		<div class="factText">
			<%=factText%>			
		</div>
		<a href="#" class="next"></a>
	</div>
</script>
<script type="text/template" id="answer_text_template">
	<input type="text" name="firstname">
	
</script>
<script type="text/template" id="answer_multiple_template">
	<div class="answer">		
		<div style="height:15px">
		</div>
		<% var checked = "checked"; %>
		<% _.each(options, function(option){ %>				
			<div class="row-fluid">
				<div name="answerOptions" value="<%=option.score%>" class="span8 offset2">
					<%=option.text%>
				</div>
			</div>	
			<%if(options.length == 2 && checked == ""){%>
				<div class="row-fluid">
					<div class="span12" style="visibility:none">						
					</div>
				</div>	
			<%}checked = "";});%>
	</div>
</script>
<script type="text/template" id="score_page_template">
	<div class="scoreInfo">
		<div style="color:white; text-align:left;font:bold 36pt arial">
			Your sugarscore is...
		</div>
				
		<% if (score >80) {%>
			<div class="score">
				<%=score%>
			</div>
			<div class="scoreAction">
				 You are at high risk for diabetes. You should definitely get your blood sugar tested at a nearby lab or hospital.
			</div>					
			<div class="filler"></div>
			<div class="scoreStatus">
				RED ALERT!
			</div>
		

		<% } else if(score <=80 && score >60){%>
			<div class="score">
				<%=score%>
			</div>					
			<div class="scoreAction">
				You might be at risk for diabetes. You should focus on reducing some weight and becoming more physically active.
			</div>				
			<div class="filler"></div>
			<div class="scoreStatus">
				CAN BE BETTER
			</div>

		<% } else if(score <= 60 && score >40){%>
			<div class="score">
				<%=score%>
			</div>					
			<div class="scoreAction">
				You can definitely improve your habits score by reducing some weight and becoming more physically active
			</div>	
			<div class="filler"></div>
			<div class="scoreStatus">
				HMMMM....ALRIGHT
			</div>
		
		<% } else if(score <= 40 && score >20){%>
			<div class="score">
				<%=score%>
			</div>					
			<div class="scoreAction">
				Your risk for diabetes is low.
			</div>								
			<div class="filler"></div>
			<div class="scoreStatus">
				GOOD
			</div>

		<% } else if(score <=20){%>		

			<div class="score">
				<%=score%>
			</div>				
						
			<div class="scoreAction">
				Your are not only at low risk for diabetes but also a role model for others
			</div>
			<div class="filler"></div>
			<div class="scoreStatus">
				EXCELLENT. 
			</div>	
			
		<% } %>
		<div class="logo">
			<img src="imgc/bot_logo.png">
		</div>
	</div>
	<div class="helpInfo">
		<div class="question">
			7% weight loss reduces diabetes risk by 58%
		</div>
		<div class="infoBox">
			<div class="infoOpaque">
			</div>
			<div id="infoContainer">
				<div class="helpText">
					You can easily achieve this</br>
					thorugh healthier eating.
				</div>
				<div class="helpText">
					Get started by downloading</br>
					the <b>food:habits</b> android app
				</div>
				<img src="imgc/food_habits_mobile.png" style="height:350px;width:200px;margin-left:30%">
				<div class="phBox">
					<span style="font:12pt arial;text-align:left;width:5%;line-height: 32px; margin-left:10%">
						Mobile:
					</span>
					<span style="margin-left:1%">
						<input style="height:32px;width:60%;" type="text" id="mobileNumber" >					
					</span>
					<input id="submitButton" type="button" value="Submit">					
				</div>
				<div class="numberSent">
				</div>		
				<div class="filler">
				</div>
				<div class="row-fluid downloadBox">
					<div class="span5 offset2 downloadText">
						Or download <b>food:habits</b> with</br>
						the Google Play<sup>TM</sup> Store app
					</div>					
					<div class="span5">					
							<img src="imgc/google_play.png" alt = "Download food:habits" onclick="javascript:window.open('https://play.google.com/store/apps/details?id=com.janacare.foodtrack', '_blank')" style="cursor:pointer;min-height:45px">
					</div>
				</div>
			</div>
		</div>
	</div>		
</script>
<script type="text/template" id="score_template">
	<div class="row-fluid absHeader">
		<div class="span5" style="color:white; text-align:center;font:bold 36pt arial">
			Your sugarscore is...
		</div>
		<div class="question offset3 span4">
			<h4><%=question%></h4>
		</div>
	</div>
	<div class="row-fluid">
		<div class="scorePage span4">			
			<% if (score >80) {%>
				<div class="score">
					<%=score%>
				</div>
				<div class="scoreAction">
					 You are at high risk for diabetes. You should definitely get your blood sugar tested at a nearby lab or hospital.
				</div>					
				<div class="filler"></div>
				<div class="scoreStatus">
					RED ALERT!
				</div>
			

			<% } else if(score <=80 && score >60){%>
				<div class="score">
					<%=score%>
				</div>					
				<div class="scoreAction">
					You might be at risk for diabetes. You should focus on reducing some weight and becoming more physically active.
				</div>				
				<div class="filler"></div>
				<div class="scoreStatus">
					CAN BE BETTER
				</div>

			<% } else if(score <= 60 && score >40){%>
				<div class="score">
					<%=score%>
				</div>					
				<div class="scoreAction">
					You can definitely improve your habits score by reducing some weight and becoming more physically active
				</div>	
				<div class="filler"></div>
				<div class="scoreStatus">
					HMMMM....ALRIGHT
				</div>
			
			<% } else if(score <= 40 && score >20){%>
				<div class="score">
					<%=score%>
				</div>					
				<div class="scoreAction">
					Your risk for diabetes is low.
				</div>								
				<div class="filler"></div>
				<div class="scoreStatus">
					GOOD
				</div>

			<% } else if(score <=20){%>		

				<div class="score">
					<%=score%>
				</div>				
							
				<div class="scoreAction">
					Your are not only at low risk for diabetes but also a role model for others
				</div>
				<div class="filler"></div>
				<div class="scoreStatus">
					EXCELLENT. 
				</div>	
				
			<% } %>
		</div>	
				
	</div>	
	<div class="socialTab">
		<a href="https://www.facebook.com/dialog/feed?
app_id=448182651920418&
link=https://developers.facebook.com/docs/reference/dialogs/&
picture=http://fbrell.com/f8.jpg&
name=Facebook%20Dialogs&
caption=Food%20Habits&
description=My%20score%20is%200%20I%20have%20no%20diabetes%20risk.&
redirect_uri=http://localhost:8080/questionairre/"><img class="socialButton" src="imgc/fb.png"></a>
	<a href="#" ><img class="socialButton" src="imgc/twitter.png"></a>	
	</div>	
</script>
<script type="text/javascript">	
	var questions = [
		{
			id:1,
			question: "What is your age? (in years)",
			answerType: "multiSelect",
			options: [{
				text:"< 35",
				score:0
			},{
				text:"35 - 49",
				score:20
			},{
				text:"> 49",
				score:30
			}
			],			
			genderType: "b",
			img: "imgc/003.jpg",
			count:2
		},
		{
			id:2,
			question: "What is your level of physical activity?											",
			answerType: "multiSelect",
			options: [{
				text:"No exercise AND sedentary work",
				score:30
			},{
				text:"Exercise regularly OR strenous work",
				score:20
			},{
				text:"Exercise regularly AND strenous work",
				score:0
			}
			],
			genderType: "b",
			img: "imgc/3_act.jpg",
			count:3
		},
		{
			id:3,
			question: "Is there any family history of diabetes?",
			answerType: "multiSelect",
			options: [{
				text:"No Family history",
				score:0
			},{
				text:"One Parent",
				score:10
			},{
				text:"Both Parents",
				score:20
			}
			],
			genderType: "b",
			img: "imgc/005.jpg",
			count:4
		},
		{
			id:4,
			question: "What is your waist size?",
			answerType: "multiSelect",
			options:[{
				text:"Less than 31 inches",
				score:0
			},{
				text:"Between 31 and 35 inches",
				score:10
			},{
				text:"Greater than 35 inches",
				score:20
			}
			],
			genderType: "f",
			img: "imgc/5_was_crop.jpg",
			count:5
		},
		{
			id:4,
			question: "What is your waist size?",
			answerType: "multiSelect",
			options:[
			{
				text:"Less than 35 inches",
				score:0
			},{
				text:"Between 35 and 40 inches",
				score:10
			},{
				text:"Greater than 40 inches",
				score:20
			}
			],
			genderType: "m",
			img: "imgc/5_was_crop.jpg",
			count:5
		},
		{
			id:5,
			question: "What is your gender?",
			answerType: "multiSelect",
			options:[ {
				text: "Male",
				score:999
			},{
				text: "Female",
				score:998
			}
			],
			img: "imgc/002.jpg",
			genderType:'b',
			count:1
		}
	];

	var facts = [
		{
			id:1,
			factText: "Fact No 1",
			img: "img1",
			genderType : "b"
		},
		{
			id:2,
			factText: "Fact No 2",
			img: "img1",
			genderType : "b"
		},
		{
			id:3,
			factText: "Fact No 3",
			img: "img1",
			genderType : "b"
		},
		{
			id:4,
			factText: "Fact No 4",
			img: "img1",
			genderType : "f"
		},
		{
			id:4,
			factText: "Fact No 5",
			img: "img1",
			genderType : "m"
		},
		{
			id:5,
			factText: "Fact No 6",
			img: "img1",
			genderType : "b"
		}

	];

	var flowOfPages = {
		flow: ["5q","1q","2q","3q","4q"],
		noOfq:5,
		pointer : 0,
		questionCount:1,
		factCount:1,
		getNext : function(){
			var next = {};
			if(this.pointer < this.flow.length){
				next["obj"] = this.flow[this.pointer];
				this.pointer = this.pointer+ 1;
				if(next["obj"].indexOf('q') == 1){
					next["count"] = this.questionCount;
					next["type"] = "q";
					this.questionCount++;
				} else {
					next["count"] = this.factCount;
					next["type"] = "f";
					this.factCount++;
				}
				return next;
			}
			return null;

		}
	};
	var gender = 'b';
	var selectedAnswers = [];
	var ApplicationView = Backbone.View.extend({
		el : "#habits",
		flowObject: {},
		score:0,
		events: {
			
		},
		initialize: function(){			
			this.setFlowHash();		
			this.createHiddenForm();	
		},
		currentPage: "",
		$form: null,
		createHiddenForm: function(){
			this.$form = $("<form name='hiddenStuff' action='https://script.google.com/macros/s/AKfycbwgYCCRM3N8Na8lFe6OwSb8lhWmVz-hA6-3pWkkgc97AsV_tQ/exec' method='post'></form>")			
		},
		setFlowHash: function(){
			this.flowObject.start = false;
			this.flowObject.questionList = [];			
		},
		render: function(){
			this.showHomePage();
			this.flowObject.start = true;
			
		},
		calculateScore: function(subtract){	
			if(this.scoreHere != undefined){				
				if(this.scoreHere == 998){
					gender = "f";
				} else if(this.scoreHere == 999){
					gender = "m";
				} 						
			}			
		},

		showScorePage: function(){	
			var score = 0;
			for(var id in selectedAnswers){
				var selectedAnswer = selectedAnswers[id];
				if(selectedAnswer.scoreHere != 998 && selectedAnswer.scoreHere != 999){
					score = score + selectedAnswer.scoreHere;
				}
			}	
			this.flowObject.start = false;
			this.$el.empty();			
			var positiveScore = 100 - this.score; 
			var template = _.template($("#score_page_template").html(),{score:score, question:"Did you know?"});
			this.$el.append(template);
			var self = this;
			$(".backgroundImg").css("background-image","url('')");	
			//$(".imgForBc").attr("src", "imgc/final_bg.jpg");
			$("#submitButton").click(function(){
				var number = parseInt($("#mobileNumber").val());
				/*var pattern = /^(7|8|9)[\d]{9,9}$/;
				if(!pattern.test(number)){
					alert("Please enter a valid mobile number");
					return false;
				}*/
				self.sendToParse(number, positiveScore);
				$(".numberSent").html("Submitted! Thank you.")
				$("#mobileNumber").val("");
			});
			var answerBox = $(".infoOpaque");		
			var height = parseInt($(window).innerHeight());
			answerBox.height(height + "px");
			userJson = {};
			userJson.selectedAnswers = selectedAnswers;
			Parse.User.save(userJson);
			_gaq.push(['_trackEvent', 'SugarScore', 'Completed', JSON.stringify(userJson)]);
		},
		sendToParse: function(number, score){
			Parse.initialize("AnPobp3k9Ct8e1le6fLDVsE8QaiIwGaeJ7KYNf5B", "1QVJqLHgjJH0owbN4qvqytuWor1twdnQaOX6pfP0");
		    var instance = null;
		    var PhoneObject = Parse.Object.extend("Phone");
		    var phone = new PhoneObject();
		    phone.save({phone: number, sentSMS: false, score:score}, {
		        success: function(object) {
		    	    $(".numberSent").html("We have sent an SMS to your Phone number");
		        }
		      });
		},
		showHeader: function(){

		},

		showHomePage: function(){
			this.currentPage = "home";
			var template= _.template($("#home_page_template").html(),{question:"Are you at risk for Diabetes?",answer:"Take this one minute test to find out",startRoute:"#questions/1"});
			this.$el.empty();
			this.$el.append(template);			
			$(".backgroundImg").css("background-image","url('imgc/001.jpg')");
			$(".enterImage").mouseover(function(){
				$(".enterImage").attr("src","imgc/enter_on.png");
			})		
			.mouseout(function(){
				$(".enterImage").attr("src","imgc/enter_off.png");
			})		
			.click(function(){
				router.navigate("#questions/1", {trigger:true});
			})
			$(".moreInfo").hide();	
			$(".learnMore").mouseover(function(){
				$(".moreInfo").show();
			})
			.mouseout(function(){
				$(".moreInfo").hide();
			})
		},
		changeRoute: function(){
			var next = flowOfPages.getNext();
			if(next != null){
				this.currentObj = next;
				if(next.type == 'q'){
					this.showNextFlowObject();
				}
			} else {
				this.showScorePage();
			}
		},				
		showNextFlowObject: function(objId){	
			this.calculateScore();			
			var obj = this.getNextFlowObject(objId);
			if(obj == null){				
				this.showScorePage();
			} else {
			var template, headerTemplate, answerHtml;			
				if(obj.question){
					this.question = obj.question;
					if(obj.answerType == "textBox"){
						answerHtml = _.template($("#answer_text_template").html(),{});	
					} else {
						answerHtml = _.template($("#answer_multiple_template").html(),{options:obj.options});
					}				
					//headerTemplate = _.template($("#header_question_template").html(), {question: obj.question, number: obj.count, total:flowOfPages.flow.length})
					var backRoute = obj.count == 1 ? "#home" : "#questions/" + (obj.count -1); 
					var nextRoute = obj.count == 5 ? "#score" : "#questions/" + (obj.count +1);
					//template = _.template($("#question_page_template").html(), {img: obj.img, answer:answerHtml, backRoute:backRoute, nextRoute: nextRoute});							
					var fullPage = {};
					fullPage.questionObj = obj;
					fullPage.answerHtml = answerHtml;
					fullPage.total = flowOfPages.flow.length;
					fullPage.backRoute = backRoute;
					fullPage.nextRoute = nextRoute;
					template = _.template($("#fullPageTemplate").html(), {fullPageObj: fullPage});
				}		
				else if(obj.factText){
					template = _.template($("#fact_page_template").html() , {img: obj.img, factText: obj.factText});
				}
				this.$el.empty();
				this.$el.append(template);
				imgUrl = "url('" + obj.img + "')";
				$("#backgroundDiv").addClass("backgroundImg");
				$(".backgroundImg").css("background-image",imgUrl);	

				if(obj.question){
					var answerBox = $(".answerOpaque");		
					var height = parseInt(answerBox.next().height());
					answerBox.height(height + "px");
				}
				this.setAnswerBehaviour();
				this.errorDiv = $("#errorDiv");
				this.errorDiv.hide();
				this.currentPage = Backbone.history.fragment;						
			}
		},
		qidExists : function(qid){
			for(var id in selectedAnswers){
				var selectedAnswer = selectedAnswers[id];
				if(selectedAnswer.qid == qid){
					return true;
				}
			}
			return false;
		},
		getSelectedAnswer : function(qid){
			for(var id in selectedAnswers){
				var selectedAnswer = selectedAnswers[id];
				if(selectedAnswer.qid == qid){
					return selectedAnswer;
				}
			}
		},
		setAnswerBehaviour: function(){
			var answerOptions = $('[name="answerOptions"]');
			var currentAns;
			var currentHover;
			var self = this;
			for(var i=0;i<answerOptions.length; i++){
				var option = answerOptions.eq(i);				
				function clickHandler(obj) {    
        			obj.click (
            			function() {
            				if(currentAns !== undefined){
            			 		currentAns.removeClass('checked');
            			 	} 
            			 	obj.removeClass('hovered');	 	
							obj.addClass('checked');
							currentAns = obj;
							var qid = $('.question').attr("count");
							var selectedAnswer;
							if(!self.qidExists(qid)){
								selectedAnswer = {};
								selectedAnswer.qid = $('.question').attr("count");
								selectedAnswers.push(selectedAnswer);					
							} else {
								selectedAnswer = self.getSelectedAnswer(qid);								
							}
							selectedAnswer.answer = currentAns.html();
							selectedAnswer.scoreHere = self.scoreHere = parseInt(currentAns.attr("value"));
																					
            			}
        			)}; 
        		function mouseoverHandler(obj){
        			obj.mouseover(
        				function(){
        					if(!obj.hasClass('checked')){
        						obj.addClass('hovered');
        					}
        				}
        		)};
        		function mouseoutHandler(obj){
        			obj.mouseout(
        				function(){
        					obj.removeClass('hovered');
        				}
        		)};       			

        		clickHandler(option);
        		mouseoverHandler(option);
        		mouseoutHandler(option);
			}
			$(function(){
				$('.backButtonHolder').click(function(){
					router.navigate($('.backButton').attr("href"), {trigger: true});
				});
			});
			$(function(){
				$('.nextButtonHolder').click(function(){
					router.navigate($('.nextButton').attr("href"), {trigger: true});
				});
			});
			var self = this;
			$('.nextButton').click(function(){				
				if(currentAns == undefined){
					self.showError();
					return false;
				} else {
					self.removeError();
					return true;
				}
			});		
		},
		showError : function(){
			this.errorDiv.show();			
		},
		removeError:function(){
			this.errorDiv.hide();
		},

		getNextFlowObject: function(givenId){
			if(this.currentObj == null){
				this.currentObj = flowOfPages.getNext();
			}
			var nextFlowObject = this.currentObj;
			var objId = givenId == undefined ? parseInt(nextFlowObject["count"])  : givenId;
			if(objId != null || givenId!= undefined){
				if(nextFlowObject["type"] == 'q'){
					for (id in questions){
						var question = questions[id];
						var compareGender = gender == undefined ? "m" : gender
						if(question.count == objId && (question.genderType == compareGender || question.genderType == 'b')){							
							return question;
						} 
					}
				} else if(nextFlowObject["type"] == 'f'){
					for(id in facts){
						var fact = facts[id];
						if(fact.id == parseInt(nextFlowObject["obj"]) && (fact.genderType == gender || fact.genderType == 'b')){
							return fact;
						}
					}
				}
			}
			return null; 
		}
	});
	var Router = Backbone.Router.extend({
		routes: {
			'':'home',
			'home':'home',			
			'questions/:id': 'questions',
			'facts/:id': 'facts',
			"score": 'score'
		}
	});
	var app = new ApplicationView();
	var router = new Router();
	router.on('route:score', function(){
		console.log("this is score");
		app.showNextFlowObject(100);		
	});
	router.on('route:questions', function(questionId){
		console.log("this is a question");
		app.showNextFlowObject(questionId);
	});
	router.on('route:facts', function(){
		console.log("this is facts");
	});

	router.on('route:home', function(){
		app.render();
	});	


	Backbone.history.start();
	var preload = ["imgc/001.jpg", "imgc/002.jpg", "imgc/003.jpg", "imgc/3_act.jpg", "imgc/005.jpg", "imgc/5_was_crop.jpg", "imgc/food_habits.jpg","imgc/final_bg.jpg"];
	var images = [];
	for (i = 0; i < preload.length; i++) {
	    images[i] = new Image();
	    images[i].src = preload[i];
	}
</script>
</body>
</html>
